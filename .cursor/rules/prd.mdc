---
alwaysApply: true
---
# [PRD] 프롬프트 스토어 "Prompt Market"

## 1. 서비스 컨셉 및 모델

- **컨셉:** 운영자가 등록한 AI 프롬프트를 사용자가 장바구니에 담아 한 번에 결제하거나, 프로필을 관리할 수 있는 온라인 상점.
- **사용자 역할:**
  - **관리자 (Admin):** 유일한 판매자. Supabase 대시보드를 통해 상품(프롬프트) 등록/관리.
  - **사용자 (User):** 회원가입 후 프롬프트를 장바구니에 담고, 구매하며, 자신의 프로필을 관리하는 소비자.

## 2. 상세 화면 명세서 (Screen Specifications)

### 2.1. 헤더 (Header - 모든 페이지 공통)

- **역할:** 사이트의 핵심 기능으로 빠르게 이동할 수 있는 전역 네비게이션 제공.
- **컴포넌트 및 기능:**
  - **로고:** 클릭 시 메인 페이지(`/`)로 이동.
  - **검색바 (메인 페이지에만 표시):**
    - **위치:** 헤더 중앙 영역
    - **기능:** 프롬프트 제목 및 설명을 실시간으로 검색
    - **동작:** 입력한 검색어로 프롬프트 목록을 필터링
  - **장바구니 아이콘:**
    - **데이터:** 현재 사용자의 장바구니에 담긴 상품 개수를 실시간으로 표시 (뱃지 형태).
    - **동작:** 클릭 시 장바구니 페이지(`/cart`)로 이동.
  - **사용자 프로필 영역:**
    - **로그인 안했을 때:** '로그인' 버튼 표시 (클릭 시 `/login`으로 이동).
    - **로그인 했을 때:**
      - **프로필 아이콘 버튼:** 클릭 시 프로필 페이지(`/profile`)로 이동.
      - **사용자 이름 버튼:** 클릭 시 구매 내역 페이지(`/my-page`)로 이동.
      - **참고:** 드롭다운 메뉴 없이 직접 링크 버튼으로 구성됨.

---

### 2.2. 메인 페이지 (프롬프트 목록)

- **경로:** `/`
- **역할:** 판매 중인 모든 프롬프트 리스트를 보여주는 스토어의 진열대.
- **주요 데이터:** 프롬프트 목록 정보 (현재는 localStorage, 향후 `prompts` 테이블 사용 예정).
- **컴포넌트 및 기능:**
  - **Hero 섹션:**
    - 서비스 소개 문구 및 메인 타이틀 표시
    - "AI 프롬프트 마켓플레이스" 등의 브랜딩 메시지
  - **필터 및 검색 영역:**
    - **카테고리 필터 사이드바:**
      - 카테고리 목록 (전체, ChatGPT, Midjourney, Claude, Stable Diffusion, 기타)
      - 선택된 카테고리로 프롬프트 목록 필터링
    - **태그 필터:**
      - 태그 목록 (마케팅, 콘텐츠 생성, 이미지 생성, 코딩, 번역, 요약, 창작 등)
      - 다중 선택 가능한 태그 필터
    - **검색 기능:**
      - 헤더의 검색바를 통한 실시간 검색
      - 제목 및 설명에서 검색어 매칭
    - **정렬 옵션:**
      - 인기순 정렬 (향후 추가 옵션 확장 가능)
  - **`PromptCard` (개별 프롬프트 카드):**
    - **표시 정보:** 대표 이미지, 제목, 설명, 가격, 카테고리, 평점, 리뷰 수, 판매량, 태그.
    - **상호작용:**
      - **카드 클릭:** 상세 페이지(`/prompt/[id]`)로 이동.
      - **'담기' 버튼:**
        - **동작:** 클릭 시 해당 상품을 사용자의 장바구니에 추가 (현재는 localStorage, 향후 `carts` 테이블 사용 예정).
        - **피드백:** "장바구니에 상품을 담았습니다." 와 같은 토스트(Toast) 알림을 띄워 사용자에게 행동이 완료되었음을 알림.
        - **상태 처리:** 만약 이미 장바구니에 있는 상품이라면 버튼을 비활성화하고 "장바구니에 있음"으로 표시.

---

### 2.3. 프롬프트 상세 페이지

- **경로:** `/prompt/[id]`
- **역할:** 개별 프롬프트의 상세 정보 제공 및 구매/장바구니 액션 유도.
- **주요 데이터:**
  - URL의 `[id]`에 해당하는 프롬프트 정보 (현재는 localStorage, 향후 `prompts` 테이블 사용 예정).
  - 로그인 사용자의 구매 내역 (해당 상품 구매 여부 확인용, 향후 `purchases` 테이블 사용 예정).
  - 로그인 사용자의 장바구니 정보 (해당 상품 장바구니 존재 여부 확인용, 향후 `carts` 테이블 사용 예정).
- **컴포넌트 및 기능:**
  - **상품 정보 영역:**
    - 대표 이미지 (썸네일)
    - 제목, 카테고리, 태그
    - 평점 및 리뷰 수
    - 판매량 정보
  - **탭 구조:**
    - **상세 설명 탭:** 프롬프트에 대한 자세한 설명, 주요 특징 목록
    - **포함 내용 탭:** 프롬프트 구매 시 포함되는 내용 목록
    - **사용 방법 탭:** 프롬프트 사용 가이드 및 방법
    - **리뷰 탭:** 구매자 리뷰 목록 (평점, 작성자, 날짜, 내용)
  - **판매자 정보 영역:**
    - 판매자 이름 및 소개
    - 판매자의 다른 프롬프트 보기 링크
  - **구매 완료 시 (향후 구현 예정):**
    - 구매 버튼 영역을 모두 제거.
    - 마스킹된 영역에 실제 프롬프트 내용(`prompt_text`)과 '복사' 버튼 표시.
  - **구매 전:**
    - **액션 버튼 영역:**
      - **'바로 구매' 버튼:** 클릭 시 해당 상품을 장바구니에 담고 결제 페이지(`/checkout`)로 이동.
      - **'장바구니 담기' 버튼:** 메인 페이지의 버튼과 동일한 로직.
      - **'좋아요' 버튼:** 관심 상품으로 표시 (현재는 UI만 제공, 향후 기능 구현 예정).
      - **'공유' 버튼:** 프롬프트 공유 기능 (현재는 UI만 제공, 향후 기능 구현 예정).

---

### 2.4. 장바구니 페이지

- **경로:** `/cart`
- **역할:** 사용자가 구매할 상품들을 최종 확인하고 결제를 진행하는 페이지.
- **주요 데이터:** 로그인 사용자의 장바구니 정보 (현재는 localStorage, 향후 `carts` 테이블 사용 예정).
- **컴포넌트 및 기능:**
  - **장바구니 목록 영역:**
    - **장바구니가 비어있을 때:** "장바구니가 비어있습니다." 메시지와 함께 메인 페이지로 가는 링크 버튼 표시.
    - **상품이 있을 때:**
      - **`CartItem` (개별 상품 행):**
        - **구성:** 상품 이미지, 제목, 카테고리, 가격.
        - **'삭제' 버튼:** 클릭 시 해당 상품을 장바구니에서 제거하고 UI를 즉시 업데이트.
      - **'장바구니 비우기' 버튼:** 모든 상품을 한 번에 제거하는 기능.
  - **결제 정보 요약 영역:**
    - **상품 금액:** 모든 상품의 가격 합계
    - **할인:** 현재 0원 (향후 할인 기능 추가 예정)
    - **총 결제 금액:** 최종 결제 금액 표시
  - **'결제하기' 버튼:**
    - **동작:** 클릭 시 결제 페이지(`/checkout`)로 이동.
    - **참고:** 현재는 결제 페이지로 이동하며, 향후 토스페이먼츠 결제창 직접 호출로 변경 예정.

---

### 2.5. 사용자 프로필 페이지

- **경로:** `/profile`
- **역할:** 사용자가 자신의 계정 정보를 확인하고 수정하는 페이지.
- **주요 데이터:** 로그인한 사용자의 프로필 정보 (현재는 localStorage, 향후 `profiles` 테이블 사용 예정).
- **컴포넌트 및 기능:**
  - **프로필 정보 표시:**
    - **프로필 아바타:** 사용자 이름의 이니셜로 표시 (현재는 이미지 업로드 미구현).
    - **이름:** 사용자 이름 (수정 가능).
    - **이메일 주소:** 수정 불가, 읽기 전용으로 표시.
    - **가입일:** 계정 생성 날짜 표시 (읽기 전용).
  - **프로필 수정 기능:**
    - **'수정하기' 버튼:** 클릭 시 이름 필드가 `input` 태그로 변경되고 '저장', '취소' 버튼이 나타남.
    - **'저장' 버튼:**
      - **동작:** 클릭 시 `input`에 입력된 값으로 사용자 이름을 업데이트 (현재는 localStorage, 향후 `profiles` 테이블의 `name` 필드 업데이트 예정).
      - **피드백:** "프로필이 저장되었습니다." 토스트 알림 표시 후 다시 읽기 모드로 전환.
    - **프로필 이미지 업로드:** 현재는 미구현 상태 (향후 구현 예정).
      - 이미지 클릭 시 파일 선택창 열림.
      - 이미지 선택 시 Supabase Storage에 업로드하고, 해당 URL을 `profiles` 테이블의 `avatar_url`에 저장.
  - **빠른 이동 링크:**
    - 구매 내역 보기 (`/my-page`)
    - 장바구니 보기 (`/cart`)
  - **로그아웃 버튼:** 계정에서 로그아웃

---

### 2.6. 구매 내역 페이지

- **경로:** `/my-page`
- **역할:** 사용자가 구매한 모든 프롬프트 목록을 확인.
- **주요 데이터:** 로그인 사용자의 구매 내역 (현재는 localStorage, 향후 `purchases` 테이블 사용 예정).
- **컴포넌트 및 기능:**
  - **구매 내역 목록:**
    - **구매 내역이 없을 때:** "구매 내역이 없습니다." 메시지와 함께 메인 페이지로 가는 링크 버튼 표시.
    - **구매 내역이 있을 때:**
      - **주문 카드:** 주문 번호, 구매 날짜, 주문 상태 (완료)
      - **주문 상품 목록:** 각 상품의 제목, 가격
      - **다운로드 버튼:** 구매한 프롬프트 다운로드 (현재는 UI만 제공, 향후 기능 구현 예정)
      - **총 결제 금액:** 해당 주문의 총 결제 금액

### 2.7. 결제 페이지

- **경로:** `/checkout`
- **역할:** 사용자가 장바구니의 상품을 최종 확인하고 결제 정보를 입력하여 결제를 완료하는 페이지.
- **주요 데이터:** 장바구니의 상품 정보 (현재는 localStorage, 향후 `carts` 테이블 사용 예정).
- **컴포넌트 및 기능:**
  - **구매자 정보 영역:**
    - **이메일 입력:** 구매한 프롬프트가 전송될 이메일 주소 입력 (필수)
    - 로그인한 사용자의 이메일이 기본값으로 설정됨
  - **결제 수단 선택:**
    - **신용/체크카드:** 모든 카드 사용 가능
    - **카카오페이:** 간편 결제
    - **네이버페이:** 간편 결제
    - **참고:** 현재는 UI만 제공되며, 향후 실제 결제 연동 예정
  - **주문 상품 요약:**
    - 주문할 상품 목록 및 개별 가격
    - 상품 금액 합계
    - 부가세 정보
    - 총 결제 금액
  - **결제 처리:**
    - **'결제하기' 버튼:** 클릭 시 결제 처리 (현재는 localStorage에 구매 기록 저장, 향후 토스페이먼츠 연동 예정)
    - 결제 완료 후 구매 내역 페이지(`/my-page`)로 이동
    - 장바구니 자동 비우기
  - **안내 사항:**
    - 디지털 상품은 구매 후 즉시 다운로드 가능
    - 구매 후 환불 불가
    - 결제 시 이용약관에 동의

## 3. 데이터 저장 방식 및 데이터베이스 스키마

### 3.1. 현재 구현 상태

- **데이터 저장:** 현재는 개발/프로토타입 단계로 **localStorage**를 사용하여 데이터를 저장합니다.
- **인증 시스템:** Mock 인증을 사용하며, zustand와 localStorage를 통해 사용자 상태를 관리합니다.
- **향후 계획:** 프로덕션 환경으로 전환 시 **Supabase**를 사용하여 데이터베이스 및 인증 시스템을 구축할 예정입니다.

### 3.2. 데이터베이스 "예시" 스키마 (Supabase)

아래 데이터베이스의 스키마는 향후 Supabase로 마이그레이션 시 사용할 예시 스키마입니다. 현재는 localStorage를 사용하지만, 프로덕션 환경에서는 아래 스키마를 기반으로 데이터베이스를 구축할 예정입니다.

### `profiles` (사용자 프로필 테이블)

- `id` (uuid, PK, FK to `auth.users.id`): 사용자 인증 ID와 1:1 관계
- `name` (text): 사용자 이름 (기존 `nickname`에서 변경)
- `avatar_url` (text, nullable): 프로필 이미지 URL
- `created_at` (timestamp): 계정 생성일
- `updated_at` (timestamp): 정보 수정일

### prompts (상품 테이블)

- id (uuid, PK): 프롬프트 고유 ID
- created_at (timestamp): 생성일
- title (text): 프롬프트 제목
- description (text): 상세 설명
- price (integer): 가격
- prompt_text (text): 실제 프롬프트 내용 (핵심 데이터)
- image_urls (text[]): 결과물 이미지 URL 배열 (Supabase Storage 경로)

### `carts` (장바구니 테이블)

- `id` (bigint, PK): 장바구니 항목 고유 ID
- `created_at` (timestamp): 생성일
- `user_id` (uuid, FK to `auth.users.id`): 사용자 ID
- `prompt_id` (uuid, FK to `prompts.id`): 담긴 프롬프트 ID
- _Constraint: `user_id`와 `prompt_id`의 조합은 `unique`해야 함 (중복 담기 방지)_

### purchases (주문/구매 기록 테이블)

- id (uuid, PK): 구매 기록 고유 ID
- created_at (timestamp): 구매일
- buyer_id (uuid, FK to auth.users): 구매자 ID
- prompt_id (uuid, FK to prompts): 구매한 프롬프트 ID
- payment_order_id (text, unique): 토스페이먼츠 주문 ID

## 4. 핵심 로직 구현 노트

### 4.1. 현재 구현 상태

- **장바구니 로직:**
  - 현재는 localStorage를 사용하여 장바구니 데이터를 관리합니다.
  - 결제 완료 시 localStorage에서 구매한 상품을 제거합니다.
- **결제 로직:**
  - 현재는 Mock 결제를 구현하여 localStorage에 구매 기록을 저장합니다.
  - 결제 페이지에서 이메일과 결제 수단을 선택할 수 있으나, 실제 결제 연동은 미구현 상태입니다.
- **인증 로직:**
  - 현재는 Mock 인증을 사용하며, zustand와 localStorage를 통해 사용자 상태를 관리합니다.
  - 로그인/회원가입 시 간단한 검증만 수행하며, 실제 서버 인증은 미구현 상태입니다.

### 4.2. 향후 구현 계획 (Supabase 마이그레이션 시)

- **장바구니 로직:**
  - 사용자가 '결제하기'를 눌러 결제에 성공하면, `carts` 테이블에서 구매가 완료된 상품들을 반드시 **삭제**해야 합니다.
  - 이 과정은 **트랜잭션**으로 처리하는 것이 가장 안전합니다. (결제 승인 → `purchases` 기록 → `carts` 삭제)
- **결제 로직 (장바구니):**
  - '결제하기' 버튼 클릭 시, 서버는 해당 유저의 `carts` 테이블을 조회하여 총액을 계산하고 이 정보를 토대로 결제를 요청해야 합니다. 클라이언트가 보내는 가격을 그대로 믿으면 안 됩니다.
  - **토스페이먼츠 연동:** 실제 결제 처리를 위해 토스페이먼츠 API를 연동하여 결제창을 호출하고, 결제 승인 후 데이터베이스에 구매 기록을 저장합니다.
- **프로필과 인증의 분리:**
  - Supabase의 `auth.users` 테이블은 인증 정보를 다루고, 별도의 `profiles` 테이블을 만들어 부가 정보를 저장하는 것이 권장되는 패턴입니다. 회원가입 시 트리거(Trigger)를 사용하여 `auth.users`에 새 레코드가 생길 때 `profiles`에도 자동으로 레코드를 생성하도록 설정하면 편리합니다.
- **프롬프트 구매 완료 확인:**
  - 프롬프트 상세 페이지에서 사용자가 해당 프롬프트를 구매했는지 확인하는 로직을 구현해야 합니다.
  - 구매 완료 시 프롬프트 내용(`prompt_text`)을 표시하고, 구매 전에는 마스킹 처리합니다.
